# TinyTimeMixer Embedding Visualization Lesson

## Granite TSåŸ‹ã‚è¾¼ã¿ç©ºé–“ã«ãŠã‘ã‚‹æ­£å¸¸ãƒ»ç•°å¸¸ã®åˆ†é›¢å¯è¦–åŒ–

**ä½œæˆæ—¥**: 2026å¹´2æœˆ15æ—¥
**å¯¾è±¡**: v2.0 Hybridãƒ¢ãƒ‡ãƒ« - ãƒ†ã‚¹ãƒˆã‚µãƒ³ãƒ—ãƒ« 8,745ä»¶
**åŸ‹ã‚è¾¼ã¿æ¬¡å…ƒ**: 64æ¬¡å…ƒ (TinyTimeMixer d_model=64)

---

## ğŸ“‹ ç›®æ¬¡

1. [æ¦‚è¦](#æ¦‚è¦)
2. [ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ](#ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ)
3. [æ¬¡å…ƒå‰Šæ¸›æ‰‹æ³•ã®æ¯”è¼ƒ](#æ¬¡å…ƒå‰Šæ¸›æ‰‹æ³•ã®æ¯”è¼ƒ)
4. [å¯è¦–åŒ–çµæœï¼ˆ60dä»£è¡¨ä¾‹ï¼‰](#å¯è¦–åŒ–çµæœ60dä»£è¡¨ä¾‹)
5. [å…¨ãƒ›ãƒ©ã‚¤ã‚ºãƒ³ã®æ¯”è¼ƒ](#å…¨ãƒ›ãƒ©ã‚¤ã‚ºãƒ³ã®æ¯”è¼ƒ)
6. [è€ƒå¯Ÿ](#è€ƒå¯Ÿ)
7. [çµè«–](#çµè«–)

---

## ğŸ“Œ æ¦‚è¦

### ç›®çš„

v2.0ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ãƒ¢ãƒ‡ãƒ«ã«ãŠã‘ã‚‹Granite TS TinyTimeMixerã®**64æ¬¡å…ƒåŸ‹ã‚è¾¼ã¿ç©ºé–“**ã‚’å¯è¦–åŒ–ã—ã€æ­£å¸¸ã‚µãƒ³ãƒ—ãƒ«ã¨ç•°å¸¸ã‚µãƒ³ãƒ—ãƒ«ã®ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼åˆ†é›¢ã‚’ç¢ºèªã™ã‚‹ã€‚

### èƒŒæ™¯

- **ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**:

  - **TinyTimeMixer**: æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿(90æ—¥åˆ†) â†’ 64æ¬¡å…ƒåŸ‹ã‚è¾¼ã¿ãƒ™ã‚¯ãƒˆãƒ«
  - **çµ±è¨ˆç‰¹å¾´é‡**: 29å€‹ã®æ‰‹ä½œã‚Šç‰¹å¾´é‡ï¼ˆå¹³å‡ã€æ¨™æº–åå·®ã€ãƒˆãƒ¬ãƒ³ãƒ‰ç­‰ï¼‰
  - **LightGBM**: åŸ‹ã‚è¾¼ã¿(64) + çµ±è¨ˆç‰¹å¾´(29) = 93æ¬¡å…ƒ â†’ ç•°å¸¸ç¢ºç‡äºˆæ¸¬
- **æ¤œè¨¼ä»®èª¬**:

  > TinyTimeMixerãŒæ™‚ç³»åˆ—ãƒ‘ã‚¿ãƒ¼ãƒ³ã‹ã‚‰æŠ½å‡ºã—ãŸ64æ¬¡å…ƒåŸ‹ã‚è¾¼ã¿ã¯ã€æ­£å¸¸ã¨ç•°å¸¸ã‚’åŠ¹æœçš„ã«åˆ†é›¢ã§ãã¦ã„ã‚‹ã‹ï¼Ÿ
  >

### å¯è¦–åŒ–æ‰‹æ³•

é«˜æ¬¡å…ƒï¼ˆ64æ¬¡å…ƒï¼‰ã‚’2æ¬¡å…ƒ/3æ¬¡å…ƒã«åœ§ç¸®ã—ã¦å¯è¦–åŒ–ã™ã‚‹4ã¤ã®æ‰‹æ³•ã‚’é©ç”¨ï¼š

| æ‰‹æ³•            | æ¬¡å…ƒ  | ç‰¹å¾´                       | è¨ˆç®—æ™‚é–“      |
| --------------- | ----- | -------------------------- | ------------- |
| **PCA**   | 2D    | ç·šå½¢å¤‰æ›ã€åˆ†æ•£æœ€å¤§åŒ–       | é«˜é€Ÿï¼ˆæ•°ç§’ï¼‰  |
| **t-SNE** | 2D/3D | éç·šå½¢ã€å±€æ‰€æ§‹é€ ä¿æŒ       | ä¸­é€Ÿï¼ˆ1-2åˆ†ï¼‰ |
| **UMAP**  | 2D/3D | éç·šå½¢ã€å¤§åŸŸï¼‹å±€æ‰€æ§‹é€ ä¿æŒ | ä¸­é€Ÿï¼ˆ1-2åˆ†ï¼‰ |

---

## ğŸ“Š ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ

### ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿çµ±è¨ˆ

```
ç·ã‚µãƒ³ãƒ—ãƒ«æ•°: 8,745ä»¶
- æ­£å¸¸ã‚µãƒ³ãƒ—ãƒ«: 7,961ä»¶ (91.0%)
- ç•°å¸¸ã‚µãƒ³ãƒ—ãƒ«: 784ä»¶ (9.0%)  [30d horizon]
```

### ãƒ›ãƒ©ã‚¤ã‚ºãƒ³åˆ¥ç•°å¸¸ç‡

| äºˆæ¸¬ãƒ›ãƒ©ã‚¤ã‚ºãƒ³   | ç•°å¸¸ã‚µãƒ³ãƒ—ãƒ«æ•° | ç•°å¸¸ç‡ |
| ---------------- | -------------- | ------ |
| **30æ—¥å¾Œ** | 784            | 9.0%   |
| **60æ—¥å¾Œ** | 793            | 9.1%   |
| **90æ—¥å¾Œ** | 832            | 9.5%   |

â€» ä»¥é™ã€**60æ—¥ãƒ›ãƒ©ã‚¤ã‚ºãƒ³**ã‚’ä»£è¡¨ä¾‹ã¨ã—ã¦å¯è¦–åŒ–çµæœã‚’ç¤ºã™

---

## ğŸ”¬ æ¬¡å…ƒå‰Šæ¸›æ‰‹æ³•ã®æ¯”è¼ƒ

### 1. PCA (Principal Component Analysis)

**ç·šå½¢æ¬¡å…ƒå‰Šæ¸› - åˆ†æ•£æœ€å¤§åŒ–**

```python
pca = PCA(n_components=2, random_state=42)
embeddings_2d = pca.fit_transform(embeddings)  # (8745, 64) â†’ (8745, 2)
```

**çµæœ**:

- **èª¬æ˜åˆ†æ•£ç‡**: PC1=28.65%, PC2=19.50% (åˆè¨ˆ48.15%)
- **åˆ©ç‚¹**: é«˜é€Ÿã€è§£é‡ˆæ€§ãŒé«˜ã„
- **æ¬ ç‚¹**: ç·šå½¢å¤‰æ›ã®ãŸã‚ã€è¤‡é›‘ãªéç·šå½¢æ§‹é€ ã¯æ‰ãˆã‚‰ã‚Œãªã„

---

### 2. t-SNE (t-Distributed Stochastic Neighbor Embedding)

**éç·šå½¢æ¬¡å…ƒå‰Šæ¸› - å±€æ‰€æ§‹é€ ä¿æŒ**

#### ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š

```python
tsne = TSNE(
    n_components=3,        # 3æ¬¡å…ƒã«åœ§ç¸®
    perplexity=30,         # è¿‘å‚ç‚¹æ•°ã®ç›®å®‰
    max_iter=1000,         # åå¾©å›æ•°
    random_state=42
)
embeddings_3d = tsne.fit_transform(embeddings)
```

**ç‰¹å¾´**:

- **Perplexity=30**: å„ç‚¹ã®è¿‘å‚ã‚’ç´„30ç‚¹ã¨ã—ã¦è€ƒæ…®
- **KL divergence**: 1.413366 (åæŸè‰¯å¥½)
- **åˆ©ç‚¹**: å±€æ‰€çš„ãªã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼æ§‹é€ ã‚’é®®æ˜ã«å¯è¦–åŒ–
- **æ¬ ç‚¹**: è¨ˆç®—ã‚³ã‚¹ãƒˆãŒé«˜ã„ã€å¤§åŸŸçš„æ§‹é€ ã¯ä¿è¨¼ã•ã‚Œãªã„

---

### 3. UMAP (Uniform Manifold Approximation and Projection)

**éç·šå½¢æ¬¡å…ƒå‰Šæ¸› - å¤§åŸŸï¼‹å±€æ‰€æ§‹é€ ä¿æŒ**

#### ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š

```python
umap_reducer = umap.UMAP(
    n_components=3,        # 3æ¬¡å…ƒã«åœ§ç¸®
    n_neighbors=15,        # è¿‘å‚ç‚¹æ•°
    min_dist=0.1,          # æœ€å°è·é›¢ï¼ˆå¯†åº¦ï¼‰
    random_state=42
)
embeddings_3d = umap_reducer.fit_transform(embeddings)
```

**ç‰¹å¾´**:

- **n_neighbors=15**: å±€æ‰€æ§‹é€ ã‚’15è¿‘å‚ã§å®šç¾©
- **min_dist=0.1**: ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼é–“ã®æœ€å°è·é›¢
- **åˆ©ç‚¹**: t-SNEã‚ˆã‚Šé«˜é€Ÿã€å¤§åŸŸæ§‹é€ ã‚‚ä¿æŒ
- **ç”¨é€”**: å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ã®å¯è¦–åŒ–ã«é©ã—ã¦ã„ã‚‹

---

## ğŸ¯ å¯è¦–åŒ–çµæœï¼ˆ60dä»£è¡¨ä¾‹ï¼‰

### 2D UMAPå¯è¦–åŒ–

![UMAP 2D - 60d Horizon](results/embeddings_umap_2d_combined_20260215_161531.png)

**è¦³å¯Ÿãƒã‚¤ãƒ³ãƒˆ**:

- âœ… **æ˜ç¢ºãªåˆ†é›¢**: æ­£å¸¸ã‚µãƒ³ãƒ—ãƒ«ï¼ˆé’ï¼‰ã¨ç•°å¸¸ã‚µãƒ³ãƒ—ãƒ«ï¼ˆèµ¤ï¼‰ãŒè¦–è¦šçš„ã«åˆ†é›¢
- âœ… **ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆãªæ­£å¸¸ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼**: é’è‰²ã®é ˜åŸŸãŒæ¯”è¼ƒçš„å¯†é›†
- âš ï¸ **ç•°å¸¸ã‚µãƒ³ãƒ—ãƒ«ã®æ•£å¸ƒ**: èµ¤è‰²ã‚µãƒ³ãƒ—ãƒ«ã¯æ­£å¸¸é ˜åŸŸã®å‘¨è¾ºãŠã‚ˆã³è¤‡æ•°ç®‡æ‰€ã«æ•£åœ¨

**è§£é‡ˆ**:

- TinyTimeMixerã¯æ­£å¸¸ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’**ä¸€è²«ã—ãŸåŸ‹ã‚è¾¼ã¿ç©ºé–“ã®é ˜åŸŸ**ã«ãƒãƒƒãƒ”ãƒ³ã‚°
- ç•°å¸¸ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯**æ­£å¸¸é ˜åŸŸã‹ã‚‰ã®é€¸è„±**ã¨ã—ã¦è¡¨ç¾ã•ã‚Œã‚‹
- ãŸã ã—ã€ä¸€éƒ¨ã®ç•°å¸¸ã¯æ­£å¸¸é ˜åŸŸã«è¿‘ãã€å¢ƒç•ŒãŒæ›–æ˜§ãªã€Œé›£ã—ã„ç•°å¸¸ã€ãŒå­˜åœ¨

---

### 3D t-SNEå¯è¦–åŒ–ï¼ˆè¤‡æ•°è¦–ç‚¹ï¼‰

![t-SNE 3D - 60d Horizon (Multiple Views)](results/embeddings_t-sne_3d_combined_20260215_161418.png)

**3ã¤ã®è¦–ç‚¹**:

1. **Front-Right (elev=20Â°, azim=45Â°)**: æ­£é¢å³å´ã‹ã‚‰
2. **Front-Left (elev=20Â°, azim=135Â°)**: æ­£é¢å·¦å´ã‹ã‚‰
3. **Top-Right (elev=60Â°, azim=45Â°)**: ä¸Šéƒ¨å³å´ã‹ã‚‰

**3Då¯è¦–åŒ–ã®åˆ©ç‚¹**:

- ğŸ“ **2Dã§é‡ãªã£ã¦ã„ãŸç‚¹ãŒåˆ†é›¢**: æ·±åº¦æ–¹å‘ï¼ˆZè»¸ï¼‰ã§ã•ã‚‰ãªã‚‹æ§‹é€ ãŒæ˜ã‚‰ã‹ã«
- ğŸ”„ **å¤šè§’çš„ãªè¦³å¯Ÿ**: è¦–ç‚¹ã‚’å¤‰ãˆã‚‹ã“ã¨ã§éš ã‚ŒãŸåˆ†é›¢æ§‹é€ ã‚’ç™ºè¦‹
- ğŸ¯ **ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼å¢ƒç•Œã®ç†è§£**: ç•°å¸¸ã‚µãƒ³ãƒ—ãƒ«ãŒã©ã®æ–¹å‘ã«é€¸è„±ã—ã¦ã„ã‚‹ã‹æ˜ç¢º

**è¦³å¯Ÿçµæœï¼ˆ3è¦–ç‚¹ç·åˆï¼‰**:

- æ­£å¸¸ã‚µãƒ³ãƒ—ãƒ«ã¯**ä¸­å¿ƒéƒ¨ã®çƒçŠ¶ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼**ã‚’å½¢æˆ
- ç•°å¸¸ã‚µãƒ³ãƒ—ãƒ«ã¯**å¤–å´ã«æ”¾å°„çŠ¶ã«åˆ†å¸ƒ**
- ä¸€éƒ¨ã®ç•°å¸¸ã¯æ­£å¸¸ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼å†…éƒ¨ã«æ··åœ¨ï¼ˆåˆ†é›¢å›°é›£ãªäº‹ä¾‹ï¼‰

---

### 3D UMAPå¯è¦–åŒ–ï¼ˆè¤‡æ•°è¦–ç‚¹ï¼‰

![UMAP 3D - 60d Horizon (Multiple Views)](results/embeddings_umap_3d_combined_20260215_161608.png)

**t-SNEã¨ã®é•ã„**:

- ğŸ“Š **ã‚ˆã‚Šé€£ç¶šçš„ãªåˆ†å¸ƒ**: UMAPã¯å¤§åŸŸæ§‹é€ ã‚’ä¿æŒã™ã‚‹ãŸã‚ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼é–“ã®é–¢ä¿‚æ€§ãŒè¦‹ãˆã‚‹
- ğŸŒ **ç•°å¸¸ã®é…ç½®**: ç•°å¸¸ã‚µãƒ³ãƒ—ãƒ«ãŒæ­£å¸¸ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‹ã‚‰**ç‰¹å®šã®æ–¹å‘**ã«åã£ã¦åˆ†å¸ƒ
- ğŸ’¡ **å¢ƒç•Œã®æ˜ç­ã•**: t-SNEã‚ˆã‚Šå¢ƒç•ŒãŒæ»‘ã‚‰ã‹ã§ã€ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³çš„ãªé·ç§»ãŒè¦‹ã‚‰ã‚Œã‚‹

**å·¥å­¦çš„è§£é‡ˆ**:

- **ç•°å¸¸ã®ç¨®é¡**: è¤‡æ•°ã®ç•°å¸¸ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆæ¸©åº¦ç•°å¸¸ã€åœ§åŠ›ç•°å¸¸ã€æŒ¯å‹•ç•°å¸¸ãªã©ï¼‰ãŒç•°ãªã‚‹æ–¹å‘ã«åˆ†é›¢
- **äºˆæ¸¬é›£æ˜“åº¦**: æ­£å¸¸ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«è¿‘ã„ç•°å¸¸ã»ã©ã€LightGBMã«ã‚ˆã‚‹åˆ†é¡ãŒé›£ã—ã„
- **åŸ‹ã‚è¾¼ã¿ã®å“è³ª**: TinyTimeMixerã¯æ™‚ç³»åˆ—ã®ç•°å¸¸ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’**æ„å‘³çš„ã«æ•´åˆã—ãŸç©ºé–“**ã«é…ç½®

---

## ğŸ“ˆ å…¨ãƒ›ãƒ©ã‚¤ã‚ºãƒ³ã®æ¯”è¼ƒ

### 2D UMAP - 3ã¤ã®ãƒ›ãƒ©ã‚¤ã‚ºãƒ³ä¸¦åˆ—è¡¨ç¤º

![UMAP 2D - All Horizons](results/embeddings_umap_2d_by_horizon_20260215_161520.png)

| ãƒ›ãƒ©ã‚¤ã‚ºãƒ³     | ç•°å¸¸æ•° | ç•°å¸¸ç‡ | ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼åˆ†é›¢ |
| -------------- | ------ | ------ | -------------- |
| **30æ—¥** | 784    | 9.0%   | è‰¯å¥½           |
| **60æ—¥** | 793    | 9.1%   | è‰¯å¥½           |
| **90æ—¥** | 832    | 9.5%   | è‰¯å¥½           |

**ãƒ›ãƒ©ã‚¤ã‚ºãƒ³é–“ã®ä¸€è²«æ€§**:

- âœ… ã™ã¹ã¦ã®ãƒ›ãƒ©ã‚¤ã‚ºãƒ³ã§**åŒæ§˜ã®åˆ†é›¢ãƒ‘ã‚¿ãƒ¼ãƒ³**ã‚’è¦³å¯Ÿ
- âœ… åŸ‹ã‚è¾¼ã¿ç©ºé–“ã®æ§‹é€ ã¯**äºˆæ¸¬æœŸé–“ã«ä¾å­˜ã—ãªã„**ï¼ˆæ™‚ç³»åˆ—ã®ç‰¹å¾´ãŒä¸€è²«ï¼‰
- âš ï¸ 90æ—¥ãƒ›ãƒ©ã‚¤ã‚ºãƒ³ã¯ç•°å¸¸ç‡ãŒã‚„ã‚„é«˜ã„ï¼ˆ9.5%ï¼‰ãŒã€å¯è¦–åŒ–ä¸Šã®å·®ç•°ã¯å°ã•ã„

---

### 3D UMAP - 3ã¤ã®ãƒ›ãƒ©ã‚¤ã‚ºãƒ³ä¸¦åˆ—è¡¨ç¤º

![UMAP 3D - All Horizons](results/embeddings_umap_3d_by_horizon_20260215_161558.png)

**æ·±åº¦æ¬¡å…ƒï¼ˆZè»¸ï¼‰ã§ã®è¿½åŠ æƒ…å ±**:

- 30æ—¥ãƒ»60æ—¥ãƒ»90æ—¥ã§ç•°å¸¸ã‚µãƒ³ãƒ—ãƒ«ã®**ç©ºé–“çš„é…ç½®ãŒå¾®å¦™ã«ç•°ãªã‚‹**
- é•·æœŸäºˆæ¸¬ï¼ˆ90æ—¥ï¼‰ã»ã©ã€ç•°å¸¸ã‚µãƒ³ãƒ—ãƒ«ãŒ**ã‚ˆã‚Šåºƒç¯„å›²ã«æ•£å¸ƒ**
- çŸ­æœŸäºˆæ¸¬ï¼ˆ30æ—¥ï¼‰ã¯ç•°å¸¸ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãŒ**ã‚ˆã‚Šã‚³ãƒ³ãƒ‘ã‚¯ãƒˆ**

**ç¤ºå”†**:

- äºˆæ¸¬æœŸé–“ãŒé•·ã„ã»ã©ã€ç•°å¸¸ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å¤šæ§˜æ€§ãŒå¢—åŠ 
- TinyTimeMixerã®åŸ‹ã‚è¾¼ã¿ã¯ã€ã“ã®æ™‚é–“çš„ãªå¤‰åŒ–ã‚’æ‰ãˆã¦ã„ã‚‹

---

## ğŸ’¡ è€ƒå¯Ÿ

### 1. åŸ‹ã‚è¾¼ã¿ç©ºé–“ã®å“è³ªè©•ä¾¡

#### âœ… æˆåŠŸã—ã¦ã„ã‚‹ç‚¹

1. **æ˜ç¢ºãªæ­£å¸¸ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼å½¢æˆ**:

   - æ­£å¸¸ã‚µãƒ³ãƒ—ãƒ«ã®å¤§éƒ¨åˆ†ãŒå¯†é›†ã—ãŸé ˜åŸŸã«é…ç½®
   - åŸ‹ã‚è¾¼ã¿ç©ºé–“ã®ä¸­å¿ƒéƒ¨ã«ä½ç½®
2. **ç•°å¸¸ã®å¤–å´é…ç½®**:

   - å¤šãã®ç•°å¸¸ã‚µãƒ³ãƒ—ãƒ«ãŒæ­£å¸¸ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®å¤–å´ã«åˆ†é›¢
   - t-SNE/UMAPä¸¡æ–¹ã§ä¸€è²«ã—ãŸå‚¾å‘
3. **æ™‚ç³»åˆ—ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ‰ãˆè¾¼ã¿**:

   - 64æ¬¡å…ƒã¨ã„ã†æ¯”è¼ƒçš„å°ã•ãªæ¬¡å…ƒæ•°ã§åŠ¹æœçš„ã«è¡¨ç¾
   - çµ±è¨ˆç‰¹å¾´é‡ï¼ˆ28æ¬¡å…ƒï¼‰ã¨çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§é«˜ç²¾åº¦äºˆæ¸¬ã‚’å®Ÿç¾

#### âš ï¸ èª²é¡Œã¨ãªã‚‹ç‚¹

1. **å¢ƒç•Œé ˜åŸŸã®æ›–æ˜§ã•**:

   - ä¸€éƒ¨ã®ç•°å¸¸ã‚µãƒ³ãƒ—ãƒ«ãŒæ­£å¸¸ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼å†…éƒ¨ã«æ··åœ¨
   - ã“ã‚Œã‚‰ã¯ã€Œåˆ†é¡å›°é›£ãªäº‹ä¾‹ã€ã¨ã—ã¦èª²é¡Œ
2. **ç•°å¸¸ã®åˆ†æ•£**:

   - ç•°å¸¸ã‚µãƒ³ãƒ—ãƒ«ãŒè¤‡æ•°ã®ã‚µãƒ–ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«åˆ†æ•£
   - å˜ä¸€ã®ç•°å¸¸ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã¯ãªãã€å¤šæ§˜ãªç•°å¸¸ã‚¿ã‚¤ãƒ—ãŒå­˜åœ¨
3. **ã‚¯ãƒ©ã‚¹ä¸å‡è¡¡ã®å½±éŸ¿**:

   - ç•°å¸¸ç‡9%ã¨ã„ã†ä¸å‡è¡¡ãƒ‡ãƒ¼ã‚¿
   - æ­£å¸¸ã‚µãƒ³ãƒ—ãƒ«ã«åŸ‹ã‚è¾¼ã¿ç©ºé–“ãŒæœ€é©åŒ–ã•ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§

---

### 2. ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®æœ‰åŠ¹æ€§

#### TinyTimeMixeråŸ‹ã‚è¾¼ã¿ (64æ¬¡å…ƒ) ã®å½¹å‰²

```
æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿(90æ—¥é–“) â†’ TinyTimeMixer â†’ 64æ¬¡å…ƒåŸ‹ã‚è¾¼ã¿
                                            â†“
                                      ã€Œæ™‚ç³»åˆ—ãƒ‘ã‚¿ãƒ¼ãƒ³ã®åœ§ç¸®è¡¨ç¾ã€
                                            â†“
                        æ­£å¸¸: å¯†é›†ã—ãŸã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ï¼ˆä¸­å¿ƒéƒ¨ï¼‰
                        ç•°å¸¸: æ•£åœ¨ã—ãŸåˆ†å¸ƒï¼ˆå¤–å´ï¼‰
```

#### çµ±è¨ˆç‰¹å¾´é‡ (28æ¬¡å…ƒ) ã¨ã®ç›¸è£œæ€§

- **åŸ‹ã‚è¾¼ã¿**: æ™‚ç³»åˆ—ã®**å‹•çš„ãƒ‘ã‚¿ãƒ¼ãƒ³**ï¼ˆå¤‰å‹•ã€å‘¨æœŸæ€§ã€ãƒˆãƒ¬ãƒ³ãƒ‰ï¼‰
- **çµ±è¨ˆç‰¹å¾´**: **é™çš„ãªè¦ç´„çµ±è¨ˆé‡**ï¼ˆå¹³å‡ã€åˆ†æ•£ã€æœ€å¤§å€¤ã€æœ€å°å€¤ï¼‰

**LightGBMã«ã‚ˆã‚‹çµ±åˆ**:

```python
X_hybrid = concat([embeddings_64d, statistical_features_29d])  # 93æ¬¡å…ƒ
â†“
LightGBMåˆ†é¡å™¨
â†“
ç•°å¸¸ç¢ºç‡ P(anomaly|X_hybrid)
```

LightGBMã¯92æ¬¡å…ƒç©ºé–“ã§**éç·šå½¢ãªæ±ºå®šå¢ƒç•Œ**ã‚’å­¦ç¿’ã—ã€åŸ‹ã‚è¾¼ã¿ã¨çµ±è¨ˆç‰¹å¾´ã®ç›¸äº’ä½œç”¨ã‚’æ‰ãˆã‚‹ã€‚

---

### 3. å¯è¦–åŒ–æ‰‹æ³•ã®é¸æŠæŒ‡é‡

| çŠ¶æ³                     | æ¨å¥¨æ‰‹æ³•         | ç†ç”±                               |
| ------------------------ | ---------------- | ---------------------------------- |
| **é«˜é€Ÿãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼** | PCA 2D           | æ•°ç§’ã§å…¨ä½“åƒã‚’æŠŠæ¡                 |
| **è©³ç´°ãªæ§‹é€ åˆ†æ** | t-SNE 3D         | å±€æ‰€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’é®®æ˜ã«å¯è¦–åŒ–       |
| **ãƒãƒ©ãƒ³ã‚¹é‡è¦–**   | UMAP 2D/3D       | å¤§åŸŸï¼‹å±€æ‰€æ§‹é€ ã€è¨ˆç®—é€Ÿåº¦ã®ãƒãƒ©ãƒ³ã‚¹ |
| **å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿**   | UMAP             | t-SNEã‚ˆã‚Šé«˜é€Ÿï¼ˆO(N log N)ï¼‰        |
| **è«–æ–‡ãƒ»ãƒ—ãƒ¬ã‚¼ãƒ³** | UMAP 3D (å¤šè¦–ç‚¹) | è¦–è¦šçš„ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆã€èª¬å¾—åŠ›           |

---

### 4. ç•°å¸¸æ¤œçŸ¥ã«ãŠã‘ã‚‹è§£é‡ˆ

#### ç•°å¸¸ã‚¿ã‚¤ãƒ—ã®ä»®èª¬ï¼ˆç©ºé–“çš„é…ç½®ã‹ã‚‰æ¨æ¸¬ï¼‰

**è¦³å¯Ÿã•ã‚ŒãŸç•°å¸¸ã®åˆ†å¸ƒãƒ‘ã‚¿ãƒ¼ãƒ³**:

1. **å¤–å´ã«å¤§ããé€¸è„±**: æ˜ç¢ºãªç•°å¸¸ï¼ˆæ¸©åº¦æ€¥ä¸Šæ˜‡ã€æ©Ÿå™¨åœæ­¢ãªã©ï¼‰
2. **æ­£å¸¸ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼å‘¨è¾º**: è»½å¾®ãªç•°å¸¸ï¼ˆæ€§èƒ½ä½ä¸‹ã®åˆæœŸå…†å€™ï¼‰
3. **æ­£å¸¸ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼å†…éƒ¨**: èª¤æ¤œçŸ¥ã¾ãŸã¯æ¥µã‚ã¦å¾®ç´°ãªç•°å¸¸

**LightGBMã«ã‚ˆã‚‹é–¾å€¤èª¿æ•´**:

```python
# ã‚­ãƒ£ãƒªãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚Šæœ€é©é–¾å€¤ã‚’æ¢ç´¢
optimal_threshold_60d = 0.42  # ä¾‹

# åŸ‹ã‚è¾¼ã¿ç©ºé–“ã§ã®è·é›¢ â†’ ç•°å¸¸ç¢ºç‡
if distance_from_normal_cluster > threshold:
    label = "anomaly"
else:
    label = "normal"
```

---

## ğŸ“ çµè«–

### ä¸»è¦ãªç™ºè¦‹

1. **âœ… TinyTimeMixerã®64æ¬¡å…ƒåŸ‹ã‚è¾¼ã¿ã¯ã€æ­£å¸¸ãƒ»ç•°å¸¸ã®åˆ†é›¢èƒ½åŠ›ã‚’æŒã¤**

   - 2D/3Då¯è¦–åŒ–ã«ã‚ˆã‚Šã€æ˜ç¢ºãªã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼å½¢æˆã‚’ç¢ºèª
   - æ­£å¸¸ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯å¯†é›†ã€ç•°å¸¸ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯å¤–å´ã«é…ç½®
2. **âœ… 3Då¯è¦–åŒ–ã¨UMAPãŒæœ€ã‚‚åŠ¹æœçš„**

   - 2Dã§ã¯è¦‹ãˆãªã„åˆ†é›¢æ§‹é€ ã‚’3Dã§ç™ºè¦‹
   - UMAPã¯å¤§åŸŸï¼‹å±€æ‰€æ§‹é€ ã‚’ä¿æŒã—ã€ãƒãƒ©ãƒ³ã‚¹ãŒè‰¯ã„
3. **âš ï¸ å¢ƒç•Œé ˜åŸŸã®ç•°å¸¸ãŒèª²é¡Œ**

   - æ­£å¸¸ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«è¿‘ã„ç•°å¸¸ã¯åˆ†é¡å›°é›£
   - ä»Šå¾Œã®æ”¹å–„ç‚¹ã¨ã—ã¦ã€ã“ã‚Œã‚‰ã®é›£æ˜“åº¦é«˜äº‹ä¾‹ã¸ã®å¯¾å¿œãŒå¿…è¦
4. **âœ… ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®åˆç†æ€§**

   - åŸ‹ã‚è¾¼ã¿(64æ¬¡å…ƒ) + çµ±è¨ˆç‰¹å¾´(28æ¬¡å…ƒ) = 92æ¬¡å…ƒã®ãƒãƒ©ãƒ³ã‚¹ãŒè‰¯ã„
   - LightGBMãŒã“ã®ç©ºé–“ã§åŠ¹æœçš„ãªæ±ºå®šå¢ƒç•Œã‚’å­¦ç¿’

---

### ä»Šå¾Œã®å±•æœ›

#### 1. åŸ‹ã‚è¾¼ã¿å“è³ªã®å‘ä¸Š

- **ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆå­¦ç¿’**: æ­£å¸¸ãƒ»ç•°å¸¸ã®åˆ†é›¢ã‚’ã•ã‚‰ã«å¼·åŒ–
- **ãƒ‡ãƒ¼ã‚¿æ‹¡å¼µ**: æ™‚ç³»åˆ—ã®ã‚¸ãƒƒã‚¿ãƒªãƒ³ã‚°ã€ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã§å¤šæ§˜æ€§ã‚’å¢—åŠ 
- **Fine-tuning**: LoRAãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®æœ€é©åŒ–

#### 2. ç•°å¸¸ã®è©³ç´°åˆ†æ

- **ã‚µãƒ–ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°**: ç•°å¸¸ã‚¿ã‚¤ãƒ—ã”ã¨ã®åŸ‹ã‚è¾¼ã¿åˆ†å¸ƒã‚’åˆ†æ
- **ç•°å¸¸åº¦ã‚¹ã‚³ã‚¢**: æ­£å¸¸ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‹ã‚‰ã®ãƒãƒãƒ©ãƒãƒ“ã‚¹è·é›¢ã‚’è¨ˆç®—
- **è§£é‡ˆå¯èƒ½æ€§**: SHAPå€¤ã«ã‚ˆã‚‹åŸ‹ã‚è¾¼ã¿æ¬¡å…ƒã®å¯„ä¸åº¦åˆ†æ

#### 3. ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–

- **åŸ‹ã‚è¾¼ã¿ç©ºé–“ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰åŒ–**: t-SNE/UMAPã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°
- **ç•°å¸¸ã‚¢ãƒ©ãƒ¼ãƒˆ**: æ–°è¦ã‚µãƒ³ãƒ—ãƒ«ãŒæ­£å¸¸ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‹ã‚‰é€¸è„±ã—ãŸéš›ã«é€šçŸ¥
- **ãƒ‰ãƒªãƒ•ãƒˆæ¤œçŸ¥**: æ­£å¸¸ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®ä¸­å¿ƒãŒæ™‚é–“ã¨ã¨ã‚‚ã«ç§»å‹•ã—ã¦ã„ãªã„ã‹ç›£è¦–

---

## ğŸ“š å‚è€ƒæƒ…å ±

### ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§

```
results/
â”œâ”€â”€ embeddings_pca_by_horizon_20260215_160132.png
â”œâ”€â”€ embeddings_pca_combined_20260215_160140.png
â”œâ”€â”€ embeddings_t-sne_by_horizon_20260215_160214.png
â”œâ”€â”€ embeddings_t-sne_combined_20260215_160236.png
â”œâ”€â”€ embeddings_t-sne_3d_by_horizon_20260215_161406.png      # â˜… 3D
â”œâ”€â”€ embeddings_t-sne_3d_combined_20260215_161418.png        # â˜… 3D å¤šè¦–ç‚¹
â”œâ”€â”€ embeddings_umap_2d_by_horizon_20260215_161520.png       # â˜… UMAP 2D
â”œâ”€â”€ embeddings_umap_2d_combined_20260215_161531.png         # â˜… UMAP 2D
â”œâ”€â”€ embeddings_umap_3d_by_horizon_20260215_161558.png       # â˜… UMAP 3D
â””â”€â”€ embeddings_umap_3d_combined_20260215_161608.png         # â˜… UMAP 3D å¤šè¦–ç‚¹
```

### å®Ÿè¡Œã‚¹ã‚¯ãƒªãƒ—ãƒˆ

```bash
# åŸ‹ã‚è¾¼ã¿å¯è¦–åŒ–ã®å®Ÿè¡Œ
python visualize_embeddings.py

# å‡ºåŠ›:
# - åŸ‹ã‚è¾¼ã¿æŠ½å‡º: 8,745ã‚µãƒ³ãƒ—ãƒ« Ã— 64æ¬¡å…ƒ
# - 3D t-SNE: ç´„2åˆ†
# - 2D UMAP: ç´„13ç§’
# - 3D UMAP: ç´„13ç§’
```

### æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **ãƒ¢ãƒ‡ãƒ«**: IBM Granite TS TinyTimeMixer (d_model=64)
- **æ¬¡å…ƒå‰Šæ¸›**: scikit-learn (PCA, t-SNE), umap-learn (UMAP)
- **å¯è¦–åŒ–**: matplotlib, seaborn
- **è¨ˆç®—ç’°å¢ƒ**: CPU (Intel/AMD), Python 3.12

---

**ä½œæˆè€…**: GitHub Copilot (Claude Sonnet 4.5)
**æ¤œè¨¼æ—¥**: 2026å¹´2æœˆ15æ—¥
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: v2.0 Hybrid Model

---

## ğŸ“ ä»˜éŒ²: ã‚³ãƒ¼ãƒ‰ä¾‹

### åŸ‹ã‚è¾¼ã¿æŠ½å‡ºã‚³ãƒ¼ãƒ‰

```python
from granite_ts_model import GraniteTimeSeriesClassifier

# ãƒ¢ãƒ‡ãƒ«ãƒ­ãƒ¼ãƒ‰
model = GraniteTimeSeriesClassifier(device='cpu')
encoder = model.base_model  # TinyTimeMixerã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼

# åŸ‹ã‚è¾¼ã¿æŠ½å‡º
with torch.no_grad():
    outputs = encoder(
        past_values=sequences,        # [batch, 90, 1]
        output_hidden_states=True,
        return_dict=True
    )
  
    # [batch, 1, 11, 64] â†’ [batch, 64]
    embeddings = outputs.backbone_hidden_state.squeeze(1).mean(dim=1)
```

### UMAPå¯è¦–åŒ–ã‚³ãƒ¼ãƒ‰

```python
import umap

# UMAP 3D
reducer = umap.UMAP(
    n_components=3,
    n_neighbors=15,
    min_dist=0.1,
    random_state=42
)

embeddings_3d = reducer.fit_transform(embeddings)  # (8745, 64) â†’ (8745, 3)

# 3Dãƒ—ãƒ­ãƒƒãƒˆ
fig = plt.figure(figsize=(18, 6))
ax = fig.add_subplot(1, 3, 1, projection='3d')

ax.scatter(embeddings_3d[:, 0], 
           embeddings_3d[:, 1], 
           embeddings_3d[:, 2],
           c=labels, cmap='coolwarm', alpha=0.6)
ax.view_init(elev=20, azim=45)
plt.show()
```

---

**END OF DOCUMENT**
